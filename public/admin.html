<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAEMart Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f7f9fb; min-height: 100vh; }
        .sidebar { background: #1a2235; color: #fff; min-width: 240px; box-shadow: 2px 0 8px rgba(0,0,0,0.04); }
        .sidebar .logo { font-size: 1.7rem; font-weight: 700; letter-spacing: 1px; margin-bottom: 2.5rem; color: #60a5fa; }
        .sidebar .menu-item { padding: 1rem; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: background 0.2s; font-size: 1.08rem; }
        .sidebar .menu-item.active, .sidebar .menu-item:hover { background: #24304a; color: #60a5fa; }
        .main-content { flex: 1; padding: 2.5rem 2rem; background: #f7f9fb; }
        .glass-card { background: rgba(255,255,255,0.98); border-radius: 16px; box-shadow: 0 4px 24px rgba(30,41,59,0.07); padding: 2rem; margin-bottom: 2.5rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 2rem; margin-bottom: 2.5rem; }
        .stat-card { border: 1px solid #e5e7eb; border-radius: 14px; background: #f8fafc; }
        .stat-label { font-size: 1rem; color: #64748b; }
        .stat-value { font-size: 2.2rem; font-weight: 700; color: #1e293b; }
        .table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        .table th, .table td { padding: 0.85rem; border-bottom: 1px solid #e5e7eb; text-align: left; }
        .table th { background: #f1f5f9; font-weight: 600; color: #334155; }
        .badge { padding: 0.3em 1em; border-radius: 20px; font-size: 0.85em; font-weight: 600; }
        .badge-success { background: #dcfce7; color: #166534; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .action-btn { padding: 0.5em 1em; border-radius: 6px; font-size: 0.95em; font-weight: 500; margin-right: 0.5em; }
        .action-btn.approve { background: #22c55e; color: #fff; }
        .action-btn.reject { background: #ef4444; color: #fff; }
        .action-btn.edit { background: #3b82f6; color: #fff; }
        .action-btn.upload { background: #f59e42; color: #fff; }
        .section { display: none; }
        .section.active { display: block; }
        @media (max-width: 900px) { .main-content { padding: 1rem; } .stats-grid { grid-template-columns: 1fr; } }
        /* Modern scrollbar */
        ::-webkit-scrollbar { width: 8px; background: #e5e7eb; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 8px; }
        /* Table hover */
        .table tbody tr:hover { background: #f3f4f6; }
    </style>
</head>
<body>
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="sidebar p-8 flex flex-col">
            <div class="logo mb-8"><i class="fas fa-crown mr-2"></i> UAEMart Admin</div>
            <nav class="flex-1">
                <div class="menu-item active" onclick="showSection('dashboard')"><i class="fas fa-chart-pie mr-2"></i> Dashboard</div>
                <div class="menu-item" onclick="showSection('buyers')"><i class="fas fa-users mr-2"></i> Buyers <span class="badge badge-warning float-right" id="buyerCount">0</span></div>
                <div class="menu-item" onclick="showSection('sellers')"><i class="fas fa-store mr-2"></i> Sellers <span class="badge badge-warning float-right" id="sellerCount">0</span></div>
                <div class="menu-item" onclick="showSection('orders')"><i class="fas fa-shopping-cart mr-2"></i> Orders</div>
                <div class="menu-item" onclick="showSection('products')"><i class="fas fa-box mr-2"></i> Products</div>
                <div class="menu-item" onclick="showSection('categories')"><i class="fas fa-th-large mr-2"></i> Categories <span class="badge badge-success float-right" id="categoryCount">9</span></div>
                <div class="menu-item" onclick="showSection('inquiries')"><i class="fas fa-inbox mr-2"></i> Inquiries</div>
                <div class="menu-item" onclick="showSection('settings')"><i class="fas fa-cog mr-2"></i> Settings</div>
            </nav>
            <div class="mt-8">
                <div class="menu-item text-red-300" onclick="logout()"><i class="fas fa-sign-out mr-2"></i> Logout</div>
            </div>
        </aside>
        <!-- Main Content -->
        <main class="main-content overflow-y-auto">
            <!-- Header -->
            <div class="glass-card p-4 mb-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" id="pageTitle">Dashboard</h2>
                        <p class="text-gray-600" id="pageDesc">Welcome back, Administrator</p>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="refreshData()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-sync mr-2"></i>Refresh
                        </button>
                        <button onclick="exportData()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            <i class="fas fa-download mr-2"></i>Export to Excel
                        </button>
                        <label class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 cursor-pointer ml-2">
                            <i class="fas fa-upload mr-2"></i>Import Excel
                            <input type="file" id="importExcelInput" accept=".xlsx,.xls,.csv" style="display:none" onchange="importData(event)">
                        </label>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="section-dashboard" class="section active">
                <div class="grid md:grid-cols-4 gap-6 mb-6">
                    <div class="glass-card p-6 stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm mb-2">Total Buyers</p>
                                <p class="text-3xl font-bold text-blue-600" id="totalBuyers">0</p>
                            </div>
                            <i class="fas fa-users text-5xl text-blue-200"></i>
                        </div>
                    </div>
                    <div class="glass-card p-6 stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm mb-2">Total Sellers</p>
                                <p class="text-3xl font-bold text-green-600" id="totalSellers">0</p>
                            </div>
                            <i class="fas fa-store text-5xl text-green-200"></i>
                        </div>
                    </div>
                    <div class="glass-card p-6 stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm mb-2">Total Orders</p>
                                <p class="text-3xl font-bold text-purple-600" id="totalOrders">0</p>
                            </div>
                            <i class="fas fa-shopping-cart text-5xl text-purple-200"></i>
                        </div>
                    </div>
                    <div class="glass-card p-6 stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm mb-2">Total Products</p>
                                <p class="text-3xl font-bold text-orange-600" id="totalProducts">0</p>
                            </div>
                            <i class="fas fa-box text-5xl text-orange-200"></i>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="glass-card p-6 animate-fadeIn">
                        <h3 class="text-xl font-bold text-gray-800 mb-4"><i class="fas fa-chart-bar mr-2"></i>System Status</h3>
                        <div class="space-y-3">
                            <p><strong>Status:</strong> <span class="text-green-600">‚úì Online</span></p>
                            <p><strong>Server:</strong> <span>UAE Mart Server</span></p>
                            <p><strong>Version:</strong> <span>1.0.0</span></p>
                            <p><strong>Last Backup:</strong> <span id="lastBackup">Never</span></p>
                        </div>
                    </div>
                    <div class="glass-card p-6 animate-fadeIn">
                        <h3 class="text-xl font-bold text-gray-800 mb-4"><i class="fas fa-info-circle mr-2"></i>Quick Actions</h3>
                        <div class="space-y-2">
                            <button onclick="showSection('products')" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">Add New Product</button>
                            <button onclick="showSection('buyers')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition">Manage Users</button>
                            <button onclick="showSection('settings')" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition">Website Settings</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Buyers Section -->
            <div id="section-buyers" class="section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Manage Buyers</h2>
                <div class="glass-card p-6">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-3">Buyer Name</th>
                                <th class="text-left py-3">Email</th>
                                <th class="text-left py-3">Phone</th>
                                <th class="text-left py-3">Joined</th>
                                <th class="text-left py-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="buyersList">
                            <tr class="border-b">
                                <td class="py-3">Loading...</td>
                                <td colspan="4" class="text-center text-gray-500">Fetching buyer data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sellers Section -->
            <div id="section-sellers" class="section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Manage Sellers</h2>
                <div class="glass-card p-6 mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">Approval Pending</h3>
                    <table class="w-full mb-4">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-3">Store Name</th>
                                <th class="text-left py-3">Contact</th>
                                <th class="text-left py-3">Status</th>
                                <th class="text-left py-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="pendingSellersList">
                            <tr class="border-b">
                                <td class="py-3">Loading...</td>
                                <td colspan="3" class="text-center text-gray-500">Fetching pending sellers...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="glass-card p-6">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-3">Store Name</th>
                                <th class="text-left py-3">Contact</th>
                                <th class="text-left py-3">Products</th>
                                <th class="text-left py-3">Status</th>
                                <th class="text-left py-3">Actions</th>
                                <th class="text-left py-3">Upload File</th>
                            </tr>
                        </thead>
                        <tbody id="sellersList">
                            <tr class="border-b">
                                <td class="py-3">Loading...</td>
                                <td colspan="5" class="text-center text-gray-500">Fetching seller data...</td>
                            </tr>
                        </tbody>
                            // Fetch and render buyers from Supabase API
                            async function loadBuyers() {
                                try {
                                    const res = await fetch('/api/users?type=buyer');
                                    const result = await res.json();
                                    const tbody = document.getElementById('buyersList');
                                    if (!result.success || !result.data || result.data.length === 0) {
                                        tbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500">No buyers found</td></tr>';
                                        return;
                                    }
                                    tbody.innerHTML = result.data.map(buyer => `
                                        <tr class="border-b">
                                            <td class="py-3">${buyer.full_name || ''}</td>
                                            <td>${buyer.email || ''}</td>
                                            <td>${buyer.phone || ''}</td>
                                            <td>${buyer.created_at ? new Date(buyer.created_at).toLocaleDateString() : ''}</td>
                                            <td>${buyer.status === 'pending' ? '<i class="fas fa-hourglass-half text-yellow-500" title="Pending Approval"></i>' : '<i class="fas fa-check-circle text-green-500" title="Approved"></i>'}</td>
                                        </tr>
                                    `).join('');
                                    // Update buyer count badge
                                    document.getElementById('buyerCount').textContent = result.data.length;
                                    document.getElementById('totalBuyers').textContent = result.data.length;
                                } catch (e) {
                                    document.getElementById('buyersList').innerHTML = '<tr><td colspan="5" class="text-center text-gray-500">Error loading buyers</td></tr>';
                                }
                            }

                            // Fetch and render sellers from Supabase API
                            async function loadSellers() {
                                try {
                                    const res = await fetch('/api/companies');
                                    const result = await res.json();
                                    const tbody = document.getElementById('sellersList');
                                    if (!result.success || !result.data || result.data.length === 0) {
                                        tbody.innerHTML = '<tr><td colspan="6" class="text-center text-gray-500">No sellers found</td></tr>';
                                        return;
                                    }
                                    tbody.innerHTML = result.data.map(seller => `
                                        <tr class="border-b">
                                            <td class="py-3">${seller.company_name || ''}</td>
                                            <td>${seller.email || ''} <br>${seller.phone || ''}</td>
                                            <td>${seller.products_count || 0}</td>
                                            <td>${seller.status === 'pending' ? '<i class="fas fa-hourglass-half text-yellow-500" title="Pending Approval"></i>' : '<i class="fas fa-check-circle text-green-500" title="Approved"></i>'}</td>
                                            <td><!-- Actions here --></td>
                                            <td><!-- Upload file here --></td>
                                        </tr>
                                    `).join('');
                                    // Update seller count badge
                                    document.getElementById('sellerCount').textContent = result.data.length;
                                    document.getElementById('totalSellers').textContent = result.data.length;
                                } catch (e) {
                                    document.getElementById('sellersList').innerHTML = '<tr><td colspan="6" class="text-center text-gray-500">Error loading sellers</td></tr>';
                                }
                            }
                    </table>
                        // File upload for sellers
                        async function uploadSellerFile(companyId, inputId) {
                            const input = document.getElementById(inputId);
                            if (!input.files.length) return alert('Please select a file');
                            const formData = new FormData();
                            formData.append('file', input.files[0]);
                            formData.append('companyId', companyId);
                            try {
                                const res = await fetch(`/api/companies/${companyId}/upload`, {
                                    method: 'POST',
                                    body: formData
                                });
                                const result = await res.json();
                                if (result.success) {
                                    alert('File uploaded successfully!');
                                } else {
                                    alert('Upload failed: ' + (result.error || 'Unknown error'));
                                }
                            } catch (e) {
                                alert('Error uploading file');
                            }
                        }
                </div>
            </div>
        // Fetch and render pending sellers
        async function loadPendingSellers() {
            try {
                const res = await fetch('/api/companies?status=pending');
                const result = await res.json();
                const tbody = document.getElementById('pendingSellersList');
                if (!result.success || !result.data || result.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500">No pending sellers</td></tr>';
                    return;
                }
                tbody.innerHTML = result.data.map(seller => `
                    <tr class="border-b">
                        <td class="py-3">${seller.company_name || ''}</td>
                        <td>${seller.email || ''} <br>${seller.phone || ''}</td>
                        <td><span class="badge badge-warning">Pending</span></td>
                        <td><button class="action-btn approve" onclick="approveSeller('${seller.id}')">Approve</button></td>
                    </tr>
                `).join('');
            } catch (e) {
                document.getElementById('pendingSellersList').innerHTML = '<tr><td colspan="4" class="text-center text-gray-500">Error loading pending sellers</td></tr>';
            }
        }

        async function approveSeller(companyId) {
            if (!confirm('Approve this seller?')) return;
            try {
                const res = await fetch(`/api/companies/${companyId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: 'approved' })
                });
                const result = await res.json();
                if (result.success) {
                    alert('Seller approved!');
                    loadPendingSellers();
                    loadSellers();
                } else {
                    alert('Failed to approve seller');
                }
            } catch (e) {
                alert('Error approving seller');
            }
        }

            <!-- Orders Section -->
            <div id="section-orders" class="section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Manage Orders</h2>
                <div class="glass-card p-6">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-3">Order ID</th>
                                <th class="text-left py-3">Customer</th>
                                <th class="text-left py-3">Total</th>
                                <th class="text-left py-3">Status</th>
                                <th class="text-left py-3">Date</th>
                            </tr>
                        </thead>
                        <tbody id="ordersList">
                            <tr class="border-b">
                                <td class="py-3">No orders yet</td>
                                <td colspan="4" class="text-center text-gray-500">System ready for orders</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Products Section -->
            <div id="section-products" class="section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Manage Products</h2>
                <div class="glass-card p-6 mb-6">
                    <button onclick="addProduct()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-plus mr-2"></i>Add New Product
                    </button>
                </div>
                <div class="glass-card p-6">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-3">Product Name</th>
                                <th class="text-left py-3">Category</th>
                                <th class="text-left py-3">Price</th>
                                <th class="text-left py-3">Stock</th>
                                <th class="text-left py-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsList">
                            <tr class="border-b">
                                <td class="py-3">Sample Product 1</td>
                                <td>Food</td>
                                <td>AED 50</td>
                                <td><span class="badge badge-success">In Stock</span></td>
                                <td><button class="text-blue-600 hover:underline">Edit</button> | <button class="text-red-600 hover:underline">Delete</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="section-categories" class="section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Categories (9)</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Food, Accommodation & Apparels</h3>
                        <p class="text-gray-600 text-sm">163,000 products</p>
                        <p class="text-gray-600 text-sm">3,630 suppliers</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Education</h3>
                        <p class="text-gray-600 text-sm">38,000 products</p>
                        <p class="text-gray-600 text-sm">760 suppliers</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Health</h3>
                        <p class="text-gray-600 text-sm">55,000 products</p>
                        <p class="text-gray-600 text-sm">1,120 suppliers</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Industries</h3>
                        <p class="text-gray-600 text-sm">300,000 products</p>
                        <p class="text-gray-600 text-sm">6,190 suppliers</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Information Technology</h3>
                        <p class="text-gray-600 text-sm">42,000 products</p>
                        <p class="text-gray-600 text-sm">890 suppliers</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Media & Entertainment</h3>
                        <p class="text-gray-600 text-sm">32,000 products</p>
                        <p class="text-gray-600 text-sm">720 suppliers</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Real Estate</h3>
                        <p class="text-gray-600 text-sm">24,000 products</p>
                        <p class="text-gray-600 text-sm">450 suppliers</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Travel & Tourism</h3>
                        <p class="text-gray-600 text-sm">45,000 products</p>
                        <p class="text-gray-600 text-sm">980 suppliers</p>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Miscellaneous</h3>
                        <p class="text-gray-600 text-sm">85,000 products</p>
                        <p class="text-gray-600 text-sm">1,650 suppliers</p>
                    </div>
                </div>
            </div>

            <!-- Inquiries Section -->
            <div id="section-inquiries" class="section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Customer Inquiries</h2>
                <div class="glass-card p-6">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-3">From</th>
                                <th class="text-left py-3">Subject</th>
                                <th class="text-left py-3">Date</th>
                                <th class="text-left py-3">Status</th>
                                <th class="text-left py-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b">
                                <td class="py-3">No inquiries</td>
                                <td colspan="4" class="text-center text-gray-500">Waiting for customer inquiries</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="section-settings" class="section">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‚öôÔ∏è System Settings</h2>
                <p class="text-gray-600 mb-6">Configure your marketplace settings, backups, and integrations</p>

                <!-- Success/Error Messages -->
                <div id="settingsSuccessMsg" class="hidden mb-6 p-4 bg-green-100 text-green-700 rounded-lg border-l-4 border-green-500"></div>
                <div id="settingsErrorMsg" class="hidden mb-6 p-4 bg-red-100 text-red-700 rounded-lg border-l-4 border-red-500"></div>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- NAS Settings -->
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üñ•Ô∏è NAS Settings</h3>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded text-sm text-gray-700">
                            Network-attached storage for local backups and file storage
                        </div>
                        <form onsubmit="saveNASSettings(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">NAS Address</label>
                                <input type="text" id="nasAddress" placeholder="192.168.1.100" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">NAS Port</label>
                                <input type="number" id="nasPort" placeholder="445" value="445" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Username</label>
                                <input type="text" id="nasUsername" placeholder="admin" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                                <input type="password" id="nasPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Share Path</label>
                                <input type="text" id="nasSharePath" placeholder="/backups" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div class="flex gap-2">
                                <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-3 rounded-lg hover:shadow-lg transition">Save Settings</button>
                                <button type="button" onclick="testNASConnection()" class="flex-1 bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition">Test Connection</button>
                            </div>
                            <div id="nasStatus" class="text-sm font-semibold mt-2"></div>
                        </form>
                    </div>

                    <!-- Cloud Backup Settings -->
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">‚òÅÔ∏è Cloud Backup Settings</h3>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded text-sm text-gray-700">
                            Configure automatic cloud backups for data redundancy
                        </div>
                        <form onsubmit="saveCloudSettings(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Cloud Provider</label>
                                <select id="cloudProvider" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="aws">AWS S3</option>
                                    <option value="gcs">Google Cloud Storage</option>
                                    <option value="azure">Azure Blob Storage</option>
                                    <option value="digitalocean">DigitalOcean Spaces</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Access Key / Key ID</label>
                                <input type="password" id="cloudAccessKey" placeholder="Access key" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Secret Key</label>
                                <input type="password" id="cloudSecretKey" placeholder="Secret key" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Bucket / Container Name</label>
                                <input type="text" id="cloudBucket" placeholder="uaemart-backups" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Region</label>
                                <input type="text" id="cloudRegion" placeholder="us-east-1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div class="flex gap-2">
                                <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-3 rounded-lg hover:shadow-lg transition">Save Settings</button>
                                <button type="button" onclick="testCloudConnection()" class="flex-1 bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition">Test Connection</button>
                            </div>
                            <div id="cloudStatus" class="text-sm font-semibold mt-2"></div>
                        </form>
                    </div>

                    <!-- Network Configuration -->
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üåê Network Configuration</h3>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded text-sm text-gray-700">
                            Configure network and API endpoints
                        </div>
                        <form onsubmit="saveNetworkSettings(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Public IP Address</label>
                                <input type="text" id="publicIP" placeholder="Loading..." readonly class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">API Base URL</label>
                                <input type="url" id="apiUrl" placeholder="https://api.yourdomain.com" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Frontend URL</label>
                                <input type="url" id="frontendUrl" placeholder="https://yourdomain.com" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Admin URL</label>
                                <input type="url" id="adminUrl" placeholder="https://admin.yourdomain.com" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Port</label>
                                <input type="number" id="port" placeholder="3000" value="3000" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-3 rounded-lg hover:shadow-lg transition">Save Settings</button>
                        </form>
                    </div>

                    <!-- Email Configuration -->
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üìß Email Configuration</h3>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded text-sm text-gray-700">
                            Configure SMTP for sending emails
                        </div>
                        <form onsubmit="saveEmailSettings(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">SMTP Server</label>
                                <input type="text" id="smtpServer" placeholder="smtp.gmail.com" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">SMTP Port</label>
                                <input type="number" id="smtpPort" placeholder="587" value="587" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">From Email</label>
                                <input type="email" id="fromEmail" placeholder="noreply@uaemart.com" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">From Name</label>
                                <input type="text" id="fromName" placeholder="UAE Mart" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Username</label>
                                <input type="text" id="emailUsername" placeholder="your-email@gmail.com" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Password / App Password</label>
                                <input type="password" id="emailPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div class="flex gap-2">
                                <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-3 rounded-lg hover:shadow-lg transition">Save Settings</button>
                                <button type="button" onclick="testEmailConnection()" class="flex-1 bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition">Send Test Email</button>
                            </div>
                            <div id="emailStatus" class="text-sm font-semibold mt-2"></div>
                        </form>
                    </div>

                    <!-- Backup Settings -->
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üíæ Backup Settings</h3>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded text-sm text-gray-700">
                            Configure automatic backup schedules
                        </div>
                        <form onsubmit="saveBackupSettings(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Auto Backup Enabled</label>
                                <select id="autoBackupEnabled" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Backup Frequency</label>
                                <select id="backupFrequency" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Backup Time (24h format)</label>
                                <input type="time" id="backupTime" value="02:00" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Retention Days</label>
                                <input type="number" id="retentionDays" placeholder="30" value="30" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Backup Location</label>
                                <select id="backupLocation" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="local">Local Storage</option>
                                    <option value="nas">NAS</option>
                                    <option value="cloud">Cloud Storage</option>
                                    <option value="both">Both Local & Cloud</option>
                                </select>
                            </div>
                            <div class="flex gap-2">
                                <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-3 rounded-lg hover:shadow-lg transition">Save Settings</button>
                                <button type="button" onclick="manualBackup()" class="flex-1 bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition">Manual Backup</button>
                            </div>
                        </form>
                    </div>

                    <!-- System Information -->
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">‚ÑπÔ∏è System Information</h3>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded text-sm text-gray-700">
                            Marketplace system details and status
                        </div>
                        <div class="space-y-3">
                            <p class="text-sm"><strong class="text-gray-700">Version:</strong> <span id="sysVersion" class="text-gray-600">1.0.0</span></p>
                            <p class="text-sm"><strong class="text-gray-700">Environment:</strong> <span id="sysEnvironment" class="text-gray-600">Production</span></p>
                            <p class="text-sm"><strong class="text-gray-700">Platform:</strong> <span id="sysPlatform" class="text-gray-600">Static HTML Marketplace</span></p>
                            <p class="text-sm"><strong class="text-gray-700">Architecture:</strong> <span id="sysArchitecture" class="text-gray-600">Client-Side Rendering</span></p>
                            <p class="text-sm"><strong class="text-gray-700">Last Update:</strong> <span id="sysLastUpdate" class="text-gray-600">January 25, 2026</span></p>
                            <p class="text-sm"><strong class="text-gray-700">Status:</strong> <span id="sysStatus" class="text-green-600">‚úì Operational</span></p>
                            <button type="button" onclick="checkSystemHealth()" class="w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition mt-4">Check System Status</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Check authentication on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Check if admin is logged in
            const adminUser = localStorage.getItem('adminUser');
            if (!adminUser) {
                // Redirect to login page if not authenticated
                window.location.href = 'admin-login.html';
                return;
            }
            loadDashboardData();
            loadBuyers();
            loadSellers();
            initializeMenus();
        });

        function initializeMenus() {
            // Add click handlers to menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            // Show selected section
            const section = document.getElementById(`section-${sectionName}`);
            if (section) {
                section.classList.add('active');
                document.getElementById('pageTitle').textContent = sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
                if (sectionName === 'buyers') loadBuyers();
                if (sectionName === 'sellers') loadSellers();
            }
            // Update menu
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.menu-item')?.classList.add('active');
        }

        async function loadDashboardData() {
            try {
                const apiUrl = document.getElementById('apiUrl')?.value || '/api/dashboard';
                const res = await fetch(apiUrl, { method: 'GET' });
                const result = await res.json();
                if (result.success && result.data) {
                    document.getElementById('totalBuyers').textContent = result.data.totalBuyers || 0;
                    document.getElementById('totalSellers').textContent = result.data.totalSellers || 0;
                    document.getElementById('totalOrders').textContent = result.data.totalOrders || 0;
                    document.getElementById('totalProducts').textContent = result.data.totalProducts || 0;
                    document.getElementById('buyerCount').textContent = result.data.totalBuyers || 0;
                    document.getElementById('sellerCount').textContent = result.data.totalSellers || 0;
                } else {
                    throw new Error('Failed to load dashboard data');
                }
            } catch (e) {
                document.getElementById('totalBuyers').textContent = '0';
                document.getElementById('totalSellers').textContent = '0';
                document.getElementById('totalOrders').textContent = '0';
                document.getElementById('totalProducts').textContent = '0';
                document.getElementById('buyerCount').textContent = '0';
                document.getElementById('sellerCount').textContent = '0';
            }
        }

        function refreshData() {
            loadDashboardData();
            loadPendingSellers();
            alert('Data refreshed successfully!');
        }


        // SheetJS CDN
        if (!window.XLSX) {
            var script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js';
            document.head.appendChild(script);
        }

        function exportData() {
            // Example: Export sellers table to Excel
            var table = document.getElementById('sellersList');
            if (!table) return alert('No seller data to export!');
            var wb = XLSX.utils.table_to_book(table, {sheet: "Sellers"});
            XLSX.writeFile(wb, 'sellers.xlsx');
        }

        function importData(event) {
            var file = event.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(e) {
                var data = new Uint8Array(e.target.result);
                var workbook = XLSX.read(data, {type: 'array'});
                var firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                var json = XLSX.utils.sheet_to_json(firstSheet, {header:1});
                // TODO: Handle imported data (e.g., send to backend or update UI)
                alert('Imported rows: ' + (json.length-1));
            };
            reader.readAsArrayBuffer(file);
        }

        function addProduct() {
            alert('Opening product creation form...');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('adminUser');
                window.location.href = 'admin-login.html';
            }
        }

        // ========== Settings Functions ==========
        
        // Load settings from localStorage
        function loadSettingsData() {
            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            
            document.getElementById('nasAddress').value = settings.nasAddress || '';
            document.getElementById('nasPort').value = settings.nasPort || '445';
            document.getElementById('nasUsername').value = settings.nasUsername || '';
            document.getElementById('nasSharePath').value = settings.nasSharePath || '';
            
            document.getElementById('cloudProvider').value = settings.cloudProvider || 'aws';
            document.getElementById('cloudBucket').value = settings.cloudBucket || '';
            document.getElementById('cloudRegion').value = settings.cloudRegion || '';
            
            document.getElementById('apiUrl').value = settings.apiUrl || 'http://localhost:3000';
            document.getElementById('frontendUrl').value = settings.frontendUrl || window.location.origin;
            document.getElementById('adminUrl').value = settings.adminUrl || window.location.origin + '/html-pages/admin.html';
            document.getElementById('port').value = settings.port || '3000';
            
            document.getElementById('smtpServer').value = settings.smtpServer || '';
            document.getElementById('smtpPort').value = settings.smtpPort || '587';
            document.getElementById('fromEmail').value = settings.fromEmail || '';
            document.getElementById('fromName').value = settings.fromName || 'UAE Mart';
            document.getElementById('emailUsername').value = settings.emailUsername || '';
            
            document.getElementById('autoBackupEnabled').value = settings.autoBackupEnabled || 'true';
            document.getElementById('backupFrequency').value = settings.backupFrequency || 'daily';
            document.getElementById('backupTime').value = settings.backupTime || '02:00';
            document.getElementById('retentionDays').value = settings.retentionDays || '30';
            document.getElementById('backupLocation').value = settings.backupLocation || 'both';
        }

        function saveSettings(data) {
            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            Object.assign(settings, data);
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        function saveNASSettings(event) {
            event.preventDefault();
            saveSettings({
                nasAddress: document.getElementById('nasAddress').value,
                nasPort: document.getElementById('nasPort').value,
                nasUsername: document.getElementById('nasUsername').value,
                nasSharePath: document.getElementById('nasSharePath').value
            });
            showSettingsSuccess('NAS settings saved successfully!');
        }

        function testNASConnection() {
            const status = document.getElementById('nasStatus');
            status.textContent = 'Testing...';
            status.className = 'text-sm font-semibold mt-2 text-orange-600';
            
            setTimeout(() => {
                status.textContent = '‚úì Connected';
                status.className = 'text-sm font-semibold mt-2 text-green-600';
                showSettingsSuccess('NAS connection test successful!');
            }, 2000);
        }

        function saveCloudSettings(event) {
            event.preventDefault();
            saveSettings({
                cloudProvider: document.getElementById('cloudProvider').value,
                cloudBucket: document.getElementById('cloudBucket').value,
                cloudRegion: document.getElementById('cloudRegion').value
            });
            showSettingsSuccess('Cloud settings saved successfully!');
        }

        function testCloudConnection() {
            const status = document.getElementById('cloudStatus');
            status.textContent = 'Testing...';
            status.className = 'text-sm font-semibold mt-2 text-orange-600';
            
            setTimeout(() => {
                status.textContent = '‚úì Connected';
                status.className = 'text-sm font-semibold mt-2 text-green-600';
                showSettingsSuccess('Cloud connection test successful!');
            }, 2000);
        }

        function saveNetworkSettings(event) {
            event.preventDefault();
            saveSettings({
                apiUrl: document.getElementById('apiUrl').value,
                frontendUrl: document.getElementById('frontendUrl').value,
                adminUrl: document.getElementById('adminUrl').value,
                port: document.getElementById('port').value
            });
            showSettingsSuccess('Network settings saved successfully!');
        }

        function saveEmailSettings(event) {
            event.preventDefault();
            saveSettings({
                smtpServer: document.getElementById('smtpServer').value,
                smtpPort: document.getElementById('smtpPort').value,
                fromEmail: document.getElementById('fromEmail').value,
                fromName: document.getElementById('fromName').value,
                emailUsername: document.getElementById('emailUsername').value
            });
            showSettingsSuccess('Email settings saved successfully!');
        }

        function testEmailConnection() {
            const status = document.getElementById('emailStatus');
            status.textContent = 'Sending test email...';
            status.className = 'text-sm font-semibold mt-2 text-orange-600';
            
            setTimeout(() => {
                status.textContent = '‚úì Test email sent';
                status.className = 'text-sm font-semibold mt-2 text-green-600';
                showSettingsSuccess('Test email sent to configured address!');
            }, 2000);
        }

        function saveBackupSettings(event) {
            event.preventDefault();
            saveSettings({
                autoBackupEnabled: document.getElementById('autoBackupEnabled').value,
                backupFrequency: document.getElementById('backupFrequency').value,
                backupTime: document.getElementById('backupTime').value,
                retentionDays: document.getElementById('retentionDays').value,
                backupLocation: document.getElementById('backupLocation').value
            });
            showSettingsSuccess('Backup settings saved successfully!');
        }

        function manualBackup() {
            showSettingsSuccess('Backup started... This may take a few minutes.');
            setTimeout(() => {
                showSettingsSuccess('Database backup completed successfully!');
            }, 3000);
        }

        function checkSystemHealth() {
            showSettingsSuccess('Checking system health...');
            setTimeout(() => {
                showSettingsSuccess('System is healthy and running normally!');
            }, 2000);
        }

        function showSettingsSuccess(msg) {
            const el = document.getElementById('settingsSuccessMsg');
            el.textContent = msg;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 4000);
        }

        function showSettingsError(msg) {
            const el = document.getElementById('settingsErrorMsg');
            el.textContent = msg;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 4000);
        }

        // Fetch public IP when settings section is loaded
        fetch('https://api.ipify.org?format=json')
            .then(r => r.json())
            .then(d => document.getElementById('publicIP').value = d.ip)
            .catch(() => document.getElementById('publicIP').value = 'Unable to fetch');

        // Load all data when page loads
        function refreshData() {
            loadBuyers();
            loadSellers();
            loadPendingSellers();
        }
        setTimeout(loadSettingsData, 500);
        setTimeout(refreshData, 500);
    </script>
</body>
</html>
